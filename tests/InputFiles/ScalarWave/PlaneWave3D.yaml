# Distributed under the MIT License.
# See LICENSE.txt for details.

Executable: EvolveScalarWave3D
Testing:
  Check: parse;execute

---

Parallelization:
  ElementDistribution: NumGridPoints

ResourceInfo:
  AvoidGlobalProc0: false
  Singletons: Auto

InitialData: &InitialData
  RegularSphericalWave:
    Profile:
      Gaussian:
        Center: 5.0
        Amplitude: 10.0
        Width: 1.0

Amr:
  Criteria:
  Policies:
    EnforceTwoToOneBalanceInNormalDirection: true
    Isotropy: Anisotropic
    Limits:
      RefinementLevel: Auto
      NumGridPoints: Auto
  Verbosity: Verbose

PhaseChangeAndTriggers:

Evolution:
  InitialTime: 0.0
  InitialTimeStep: 0.001
  MinimumTimeStep: 1e-7
  TimeStepper:
    AdamsBashforth:
      Order: 3

DomainCreator:
  Sphere:
    InnerRadius: &InnerRadius 1.0
    OuterRadius: &OuterRadius 10.0
    Interior:
      ExciseWithBoundaryCondition:
        DirichletAnalytic:
          AnalyticPrescription: *InitialData
    InitialRefinement:
      Shell0: [2, 2, 2]
    InitialGridPoints: 8
    UseEquiangularMap: True
    EquatorialCompression: None
    RadialPartitioning: []
    RadialDistribution: Linear
    WhichWedges: All
    OuterBoundaryCondition:
      DirichletAnalytic:
        AnalyticPrescription: *InitialData
    TimeDependentMaps:
      RadialTranslation:
        InitialTime: 0.0
        InnerMapInitialValues: [0.0, 0.0]
        OuterMapOptions: None
        # OuterMapOptions:
        #   InitialValues: [0.0, 0.8]
        #   InnerOuterRadius: [*InnerRadius, *OuterRadius]

SpatialDiscretization:
  BoundaryCorrection:
    UpwindPenalty:
  DiscontinuousGalerkin:
    Formulation: StrongInertial
    Quadrature: GaussLobatto

# If filtering is enabled in the executable the filter can be controlled using:
# Filtering:
#   ExpFilter0:
#     Alpha: 12
#     HalfPower: 32
#     Enable: false
#     BlocksToFilter: All

EventsAndTriggers:
  - Trigger:
      Times:
        Specified:
          Values: [&final_time 0.05]
    Events:
      - Completion
  - Trigger: Always
    Events:
      - ChangeSlabSize:
          DelayChange: 0
          StepChoosers:
            - StepToTimes:
                Times:
                  Specified:
                    Values: [*final_time]

EventsAndDenseTriggers:

ControlSystems:
  MeasurementsPerUpdate: 4
  WriteDataToDisk:  True
  Verbosity: Silent
  RadialTranslation:
    IsActive: false
    Averager:
      AverageTimescaleFraction: 0.25
      Average0thDeriv: false
    Controller:
      UpdateFraction: 0.3
    TimescaleTuner:
      InitialTimescales: 0.2
      MinTimescale: 1.0e-2
      MaxTimescale: 20.0
      IncreaseThreshold: 2.5e-4
      DecreaseThreshold: 1.0e-3
      IncreaseFactor: 1.01
      DecreaseFactor: 0.98
    ControlError:
      InnerOuterRadius: [*InnerRadius, *OuterRadius]
      InnerOuterSafetyDistances: None

Observers:
  VolumeFileName: "ScalarWavePlaneWave3DVolume"
  ReductionFileName: "ScalarWavePlaneWave3DReductions"
